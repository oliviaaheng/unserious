---
import Layout from "../layouts/Layout.astro";
---

<Layout public>
  <Fragment slot="head">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600&family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
  </Fragment>

  <main class="flex flex-1 justify-center px-5 pb-14 pt-10 sm:px-8">
    <div class="w-full max-w-2xl">
      <h1 class="mb-6 text-center font-['Fraunces'] text-3xl sm:text-4xl">
        Explore
      </h1>
      <div class="mb-8">
        <input
          id="searchInput"
          type="text"
          placeholder="Search itineraries..."
          class="w-full rounded-lg border border-[#e6e1dd] bg-white px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#2b2623]"
        />
      </div>
      <!-- Feed -->
      <div id="feed" class="flex flex-col gap-6"></div>
    </div>
  </main>

  <script>
    let allData: any[] = [];

    async function fetchExploreFeed() {
      return [
        {
          user: {
            name: "Alex Johnson",
            username: "alexj"
          },
          itinerary: {
            title: "One Day in NYC",
            destination: "New York City",
            eventCount: 5
          }
        },
        {
          user: {
            name: "Maya Chen",
            username: "mayac"
          },
          itinerary: {
            title: "SF Coffee Crawl",
            destination: "San Francisco",
            eventCount: 4
          }
        }
      ];
    }

    function createCard(data: any) {
      const initials = data.user.name
        .split(" ")
        .map((n: string) => n[0])
        .join("")
        .slice(0, 2)
        .toUpperCase();

      return `
        <div class="rounded-xl border border-[#e6e1dd] bg-white p-5 shadow-sm">
          <div class="mb-4 flex items-center gap-4">
            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-[#e6e1dd] font-semibold text-[#2b2623]">
              ${initials}
            </div>
            <div>
              <p class="font-medium">${data.user.name}</p>
              <p class="text-sm text-[#5e4b41]">@${data.user.username}</p>
            </div>
          </div>

          <div class="rounded-lg bg-[#f3f1ef] p-4">
            <h2 class="text-lg font-semibold">
              ${data.itinerary.title}
            </h2>
            <p class="text-sm text-[#5e4b41]">
              ${data.itinerary.destination} · ${data.itinerary.eventCount} activities
            </p>
          </div>

          <div class="mt-4 text-right">
            <a
              href="/itinerary"
              class="text-sm font-medium text-[#2b2623] hover:underline"
            >
              View itinerary →
            </a>
          </div>
        </div>
      `;
    }

    function filterAndRender(query: string) {
      const feed = document.getElementById("feed");
      const filtered = allData.filter((item) => {
        const searchText = query.toLowerCase();
        return (
          item.itinerary.title.toLowerCase().includes(searchText) ||
          item.itinerary.destination.toLowerCase().includes(searchText) ||
          item.user.name.toLowerCase().includes(searchText)
        );
      });

      if (feed) {
        feed.innerHTML = filtered.map(createCard).join("");
      }
    }

    async function loadFeed() {
      allData = await fetchExploreFeed();
      const searchInput = document.getElementById("searchInput") as HTMLInputElement;
      
      filterAndRender("");

      searchInput?.addEventListener("input", (e) => {
        filterAndRender((e.target as HTMLInputElement).value);
      });
    }

    loadFeed();
  </script>
</Layout>
